language: node_js

cache:
  directories:
    - node_modules

node_js:
  - '6'
  - '7'
  - '8'

env:
  - MODULE="quantum-api"
  - MODULE="quantum-changelog"
  - MODULE="quantum-code-highlight"
  - MODULE="quantum-diagram"
  - MODULE="quantum-docs"
  - MODULE="quantum-dom"
  - MODULE="quantum-html"
  - MODULE="quantum-core"
  - MODULE="quantum-template"
  - MODULE="quantum-version"
  - MODULE="cross-compatible"
  - MODULE="docs"

before_install:
  - if [ "$MODULE" != "cross-compatible" ]; then cd "$MODULE" || return; fi

install:
  - if [ "$MODULE" != "cross-compatible" ]; then npm install; else npm run link-all && npm install; fi

script: npm test && npm run upload-coverage

deploy:
  email: quantumjs.ci.noreply@ocado.com
  provider: npm
  api_key:
    secure: I3e7AuCLImgTK+sPhyNaAMtpwx+Si87HvhrMCsjqhTwNHBIOVL1/JE97pmBxtI/eT1XMFkvaXFnGnQVWyvt/mUEmq7WHRh9ob+6wtQdEME8B/jbUvHwsSCymywG24iWH4OVnyPX2hXE7mCow372J++maCn45kH9U6eEoSJx+w+VcWJ1ZlG+HLWZ0FxmCvKqXkwDclUir+FuarumErQ5eBYKX7xNxEOLjb2vUXK5xaG/2N/ipVEJSAT9+Rwza2zN2W9n19Z8IVPbd5izlG3/phO4rV6t37HI5iSPosrmhFv8buuaVlnG9PdEhQ8negCqSuJ7DWtQc3Hv0Vty0P+GPg5K9AhKC1R7wYGd557/hiwSadMKba/etqPHBcMsWlbFFeshl4KtObie+IkS2Zwskb/tDWdAG6DdSl+L+hJgTXWDj6+ptmimrdjMUyg4Ql9LoHfwBkKGnzOk2XwVeDIiWHWTXQN3eWNB1v4G/6Eodkt0g0n8N6o0cEKjWTKQwQ7bDbQ3pILZO0WBkdY7YZoXRhVtuiOpTrmvMBOcJQfgfL8h+Yh0ZTBhr0Yg+YaO0jgm9o3T20FawFdVQEcK0/wB9iXZTwSc58NvU1LjYBDND6Hfu30Omc8OFv/DW6SL41X0f3mIQ8rMM7hOZtJFTeGL+H+kkFKmcu0+lDSy7CVp/6Bw=
  on:
    repo: ocadotechnology/quantumjs
    branch: master
    tags: true
    node: "6"
    condition: $TRAVIS_TAG = $MODULE*