language: node_js

cache:
  directories:
    - $HOME/.npm

node_js:
  - '6'
  - '7'
  - '8'

env:
  - MODULE="quantum-api"
  - MODULE="quantum-code-highlight"
  - MODULE="quantum-core"
  - MODULE="quantum-diagram"
  - MODULE="quantum-docs"
  - MODULE="quantum-dom"
  - MODULE="quantum-html"
  - MODULE="quantum-template"
  - MODULE="quantum-markdown"
  - MODULE="quantum-version"
  - MODULE="integration"
  # - MODULE="docs"

before_install:
  - if [ "$MODULE" != "integration" ]; then cd "$MODULE" || return; fi

install:
  - if [ "$MODULE" != "integration" ]; then npm install; else npm install && npm run link-all; fi

script:
  - if [ "$MODULE" != "integration" ]; then npm test && npm run upload-coverage; else npm test; fi

deploy:
  email: quantumjs.ci.noreply@ocado.com
  provider: npm
  api_key:
    secure: v9/6ZEYthP9ewv3hS2XkD4mnbCyPaoniP0UX/022PxuGT1gb0Vd0KVO8fnXjC/FpAJ3/0v6ph/nkCBt36bp3D5/RgmKi7C4QOXcESVt7NMViQKqkfm/VGu3EMg57D06cR3FDWoq+oYc/1HEzMlxMfQsl9h7ojkCi+9uNO5KLPDQSiAzDKrlrkCKP/M5kWEZJ60lHiXZy5LVUmnsd6dcEqRPUV+JJcn6JSmJ2G6g7UESIR4tcWrNo2ADZWpW5QlLE4BwIkX/m2kkrY2zqK7DtR9GeKGba3J/JxtrsFsxTUxNoog34CHUT/9FDKUaetP1dmc+2ApyUgFlvrd2LsysryokqNw7HWezUUexa1manrD/rLyi+o591etrIsjza42zZGaY4AI5vESlry1uzLmod8gwIU3e6f9ZhGiyQ2l2BFZeb6bdzJyGZyJ9nD1jbcT1F9VF4116d8dYlRyrdRZAZwOYhDVtysYv5MPkrdv7LcY7ov4bypcatu8tIQgRc9pnw///gW5GXXkG+wp/83t8sntmMG77aPuXR5Zq0l5anOnFRH2QVSesZc++eAHYJFT6cyLQiuNhQcSKpdrFLYPqsz25QvpnDWP8zT3g4D1Dt7aWtwgJz9hLFfIkW71XHDTw7/dVSPe2RD1sqzXt35KCxzGC9jIW5oqYPV9+djXAy1/M=
  on:
    repo: ocadotechnology/quantumjs
    branch: master
    tags: true
    node: "6"
    condition: $TRAVIS_TAG = $MODULE*
