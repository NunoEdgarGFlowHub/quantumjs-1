language: node_js

cache:
  directories:
    - node_modules

node_js:
  - '6'
  - '7'
  - '8'

env:
  - MODULE="quantum-api"
  - MODULE="quantum-changelog"
  - MODULE="quantum-code-highlight"
  - MODULE="quantum-diagram"
  - MODULE="quantum-docs"
  - MODULE="quantum-dom"
  - MODULE="quantum-html"
  - MODULE="quantum-core"
  - MODULE="quantum-template"
  - MODULE="quantum-version"
  - MODULE="cross-compatible"
  - MODULE="docs"

before_install:
  - if [ "$MODULE" != "cross-compatible" ]; then cd "$MODULE" || return; fi

install:
  - if [ "$MODULE" != "cross-compatible" ]; then npm install; else npm run link-all && npm install; fi

script: npm test && npm run upload-coverage

deploy:
  email: quantumjs.ci.noreply@ocado.com
  provider: npm
  api_key:
    secure: HgRJBRbyT+rQnnugl5R33Kb7geN3x7rw6XsE5ALxs5P+JWlxq7gfoUd23iPK1p7y/ixy+PeOC+vbxI/fRQdfqH9wDzjPhj9ZDMshKLX3ZeZnqG+P6MPf3wNp9EGqmTWzoYmruBQEof31RMCEplsEjgA+RJX/WHsfyjZKpzVLJboFLULdnX1VBu180s7XxQ//gGd6nq5lc69cm7BjCwCyhCAHs29YyRpTIV4K6tooeJWv1ZwTqq4U7gzKE0AgJJFfButcxy15NeZ8sxp9ZHCeY7kaXstCSpfBPwD6pR5ee0LLy208by5xYMpqjwGhlpeeXY45XUhBjlsltmIwJT4h5zZWFvE/K51uqf2LwlCa7512v4GdTv7d6nPP5W2oEoZrOBCPmUWm6syYH4qD08nrTc8rJG3bVw/SL6GTXhMJ15itg7NYHTSF2bIjISAcm02CFaIiLL5LYfEME9+ENHWc0N1rAM0Qt2besz+4RuY1e/wdvJceXuKulL1OikZuuQB5/t6olUeMbJnCPowv6t7w/38k03HAv/NWs3DXavtqrn+vw7pvOgGM7pQ/ZpjmZXdMZofkC27KD9lz3ez4fZk53urxP9Rn4Cq3IXFz7qB5Poi76dht+wD9AJVsyS4yqVo1eZoKG1nBR1Wkg1psuWKMfAUCxDPSmCS/wLnDI4JPXE8=
  on:
    repo: ocadotechnology/quantumjs
    branch: master
    tags: true
    node: "6"
    condition: $TRAVIS_TAG = $MODULE*